#include "libs/xcl2/xcl2.hpp"
#include <zmq.hpp>
#include <iostream>
#include <string>

#include <thread>

int main()
{
  ///////////////////////////////////////////////////////////////////////////////////////
  // ZEROMQ SETUP
  ///////////////////////////////////////////////////////////////////////////////////////

  zmq::context_t zmq_context(1);
  zmq::socket_t socket(zmq_context, zmq::socket_type::rep);
  socket.bind("tcp://*:5555");
  

  while (true)
  {
    /////////////////////////////////////////////////////////////////////////////////////
    // RECEIVE REQUEST
    /////////////////////////////////////////////////////////////////////////////////////

    zmq::message_t request;
    socket.recv(request);
    
    // std::cout << "Received " << std::string((char*)request.data(), request.size()) << std::endl;

    /////////////////////////////////////////////////////////////////////////////////////
    // SEND RESPONSE
    /////////////////////////////////////////////////////////////////////////////////////

    zmq::message_t reply(request.size());
    memcpy((void *) reply.data (), (void *) request.data(), request.size());
    socket.send(reply, zmq::send_flags::none);
  }
  
  return 0;
}